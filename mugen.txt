local warmup_url = "https://protected-roblox-scripts.onrender.com/a999a85097e0ea3d10c0917c2860003e"
local main_url = "https://protected-roblox-scripts.onrender.com/3d663091bfda9b10e15d7c29cf0595d1"

local _old_print = print
local _mugen_loaded = false
print = function(...)
    local msg = table.concat({...}, " ")
    if msg:find("invis hub mugen") then
        _mugen_loaded = true
    end
    _old_print(...)
end

local function printProgress(percent)
    local barLength = 20
    local filledLength = math.floor(barLength * percent / 100)
    local bar = string.rep("█", filledLength) .. string.rep("░", barLength - filledLength)
    print(string.format("[Loading] %3d%% [%s]", percent, bar))
end

print("[Loading] Warming up the server (using warmup script)...")
local warmupSuccess = pcall(function()
    game:HttpGet(warmup_url)
end)
if warmupSuccess then
    print("[Loading] Warmup script responded.")
else
    warn("[Loading] Warmup request failed, but will continue.")
end

wait(0.7)

printProgress(20)
for i = 21, 99, 13 do
    wait(0.25)
    printProgress(i)
end

wait(1)
printProgress(100)
print("[Loading] Loading the main script...")

local function injectScript()
    local success, result = pcall(function()
        return game:HttpGet(main_url)
    end)
    if success and result and #result > 0 then
        local ok, err = pcall(function()
            loadstring(result)()
        end)
        if ok then
            print("[Loading] Script loaded successfully!")
            return true
        else
            warn("[Loading] Script error: " .. tostring(err))
        end
    else
        warn("[Loading] Failed to load script.")
    end
    return false
end

local maxAttempts = 10
local attempt = 1
while attempt <= maxAttempts do
    injectScript()
    for i = 1, 10 do
        if _mugen_loaded then break end
        wait(0.2)
    end
    if _mugen_loaded then
        print("[Loading] Script print detected, done!")
        break
    else
        print(string.format("[Loading] Attempt %d/%d failed, retrying...", attempt, maxAttempts))
        attempt = attempt + 1
    end
end

if not _mugen_loaded then
    warn("[Loading] Pls inject script again")
end
