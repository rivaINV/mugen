local warmup_url = "https://protected-roblox-scripts.onrender.com/a999a85097e0ea3d10c0917c2860003e"
local main_url = "https://protected-roblox-scripts.onrender.com/3d663091bfda9b10e15d7c29cf0595d1"

-- Print hook for script detection
local _old_print = print
local _mugen_loaded = false
print = function(...)
    local msg = table.concat({...}, " ")
    if msg:find("invis hub mugen") then
        _mugen_loaded = true
    end
    _old_print(...)
end

-- GUI Loader
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MugenLoaderGui"
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false
screenGui.Parent = game:GetService("CoreGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 320, 0, 80)
mainFrame.Position = UDim2.new(0.5, -160, 0.5, -40)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local progressBack = Instance.new("Frame")
progressBack.Size = UDim2.new(1, -20, 0, 20)
progressBack.Position = UDim2.new(0, 10, 0, 50)
progressBack.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
progressBack.BorderSizePixel = 0
progressBack.Parent = mainFrame
progressBack.ZIndex = 0

local progressBar = Instance.new("Frame")
progressBar.Size = UDim2.new(0, 0, 0, 20)
progressBar.Position = UDim2.new(0, 10, 0, 50)
progressBar.BackgroundColor3 = Color3.fromRGB(125, 85, 255)
progressBar.BorderSizePixel = 0
progressBar.Parent = mainFrame
progressBar.ZIndex = 1

local percentLabel = Instance.new("TextLabel")
percentLabel.Size = UDim2.new(1, 0, 0, 30)
percentLabel.Position = UDim2.new(0, 0, 0, 10)
percentLabel.BackgroundTransparency = 1
percentLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
percentLabel.Font = Enum.Font.GothamBold
percentLabel.TextSize = 24
percentLabel.Text = "Loading: 0%"
percentLabel.Parent = mainFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, 0, 0, 20)
statusLabel.Position = UDim2.new(0, 0, 0, 40)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 16
statusLabel.Text = "Warming up the server..."
statusLabel.Parent = mainFrame

local function updateGui(percent, status)
    percentLabel.Text = "Loading: " .. percent .. "%"
    statusLabel.Text = status or ""
    progressBar.Size = UDim2.new(percent/100, 0, 0, 20)
end

-- Console progress bar
local function printProgress(percent)
    local barLength = 20
    local filledLength = math.floor(barLength * percent / 100)
    local bar = string.rep("█", filledLength) .. string.rep("░", barLength - filledLength)
    print(string.format("[Loading] %3d%% [%s]", percent, bar))
end

-- 1. Просто разбудить сервер (ping, не выполняем код)
print("[Loading] Warming up the server (ping only)...")
updateGui(0, "Warming up the server (ping only)...")
local pingSuccess, pingError = pcall(function()
    game:HttpGet(warmup_url)
end)
if pingSuccess then
    print("[Loading] Warmup ping OK.")
    updateGui(5, "Warmup ping OK.")
else
    warn("[Loading] Warmup ping failed: " .. tostring(pingError))
    updateGui(5, "Warmup ping failed, continuing...")
end

wait(0.3)
printProgress(10)
updateGui(10, "Executing warmup script (1/3)...")

-- 2. Выполнить warmup-скрипт 3 раза подряд с интервалом 0.5 сек
for i = 1, 3 do
    local warmupSuccess, warmupError = pcall(function()
        local warmup_code = game:HttpGet(warmup_url)
        if warmup_code and #warmup_code > 0 then
            loadstring(warmup_code)()
        end
    end)
    if warmupSuccess then
        print("[Loading] Warmup script executed ("..i.."/3).")
        updateGui(10 + i*10, "Warmup script executed ("..i.."/3).")
    else
        warn("[Loading] Warmup script error ("..i.."/3): " .. tostring(warmupError))
        updateGui(10 + i*10, "Warmup script error ("..i.."/3), continuing...")
    end
    wait(0.5)
end

printProgress(40)
updateGui(40, "Loading...")

for i = 41, 80, 10 do
    wait(0.12)
    printProgress(i)
    updateGui(i, "Loading...")
end

wait(0.3)
printProgress(90)
updateGui(90, "Loading main script...")

-- 3. Загружаем и выполняем основной скрипт
local function injectScript()
    local success, result = pcall(function()
        return game:HttpGet(main_url)
    end)
    if success and result and #result > 0 then
        local ok, err = pcall(function()
            loadstring(result)()
        end)
        if ok then
            print("[Loading] Script loaded successfully!")
            updateGui(100, "Script loaded successfully!")
            return true
        else
            warn("[Loading] Script error: " .. tostring(err))
            updateGui(100, "Script error!")
        end
    else
        warn("[Loading] Failed to load script.")
        updateGui(100, "Failed to load script!")
    end
    return false
end

wait(0.3)
printProgress(100)
updateGui(100, "Finalizing...")

local maxAttempts = 10
local attempt = 1
while attempt <= maxAttempts do
    injectScript()
    for i = 1, 10 do
        if _mugen_loaded then break end
        wait(0.2)
    end
    if _mugen_loaded then
        print("[Loading] Script print detected, done!")
        updateGui(100, "Done!")
        wait(0.5)
        screenGui:Destroy()
        break
    else
        print(string.format("[Loading] Attempt %d/%d failed, retrying...", attempt, maxAttempts))
        updateGui(100, string.format("Attempt %d/%d failed, retrying...", attempt, maxAttempts))
        attempt = attempt + 1
        wait(0.5)
    end
end

if not _mugen_loaded then
    warn("[Loading] Please inject script again")
    updateGui(100, "Please inject script again")
    wait(2)
    screenGui:Destroy()
end
